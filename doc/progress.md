# 開発進捗管理

[要件定義書](./requirements.md) に基づく機能開発の進捗を管理する。  
**凡例**: `未着手` | `作業中` | `完了`

**最終更新**: 2025-02-10

---

## 技術的改善（優先度：高）

### Supabase SSR 移行とAPI Route整理

**全体状況**: 完了（一部保留あり）  
**完了日**: 2025-02-10

| # | タスク | 状況 | メモ |
|---|--------|------|------|
| 0.1 | @supabase/ssr パッケージのインストール | 完了 | `@supabase/ssr` を追加 |
| 0.2 | Server用/Client用Supabaseクライアントの作成 | 完了 | `src/lib/supabase/server.ts`, `client.ts` を作成 |
| 0.3 | 既存コードの移行（supabase.ts, supabaseDto.ts等） | 完了 | 既存の関数は互換性を維持しつつ内部実装を更新 |
| 0.4 | 不要なGET用API Routeの削除 | 完了 | `/api/lift-logs/[resortId]` を削除（Server Componentsで代替） |
| 0.5 | **Middleware の実装** | **保留** | **認証機能実装時まで保留。現時点では認証不要のため不要** |
| 0.6 | ビルドとテストの確認 | 完了 | Next.js/Cloudflare Workers両方のビルド成功を確認 |

**備考**:
- プロジェクトルール（`.cursor/rules/project-rules.mdc`）への準拠を実施
- Middleware は認証機能が必要になった時点で実装予定
- 現在は認証なしで動作するが、将来の認証機能追加を見据えた構造は整備済み
- `/api/update-lift-statuses` はCron用として維持（プロジェクトルールに準拠）

**Middleware 保留の理由**:
- 現時点では認証機能が不要であり、Supabase Auth の使用がない
- Middleware は主に Supabase のセッション管理とCookie書き込みのために必要
- 認証機能実装時（優先度：高）に併せて実装することで、無駄な実装を避ける

**認証機能実装時に必要なMiddleware関連作業**:
1. `middleware.ts` をプロジェクトルートに作成
2. Supabase セッションのリフレッシュ処理を実装
3. Cookie の適切な書き込み処理
4. 保護されたルートへのアクセス制御

---

## 全体サマリ

| 機能 | 全体状況 | 進捗 |
|------|----------|------|
| 1. 認証機能の追加 | 未着手 | 0 / 4 |
| 2. Weekly 機能の追加 | 未着手 | 0 / 4 |
| 3. マイページの追加 | 未着手 | 0 / 5 |
| 4. 課金システムの導入 | 未着手 | 0 / 5 |
| 5. 天気情報の追加 | 未着手 | 0 / 5 |

---

## 1. 認証機能の追加（優先度：高）

**全体状況**: 未着手

| # | タスク | 状況 | メモ |
|---|--------|------|------|
| 1.1 | Supabase プロジェクトで Google OAuth を有効化 | 未着手 | |
| 1.2 | クライアント／サーバーでの Supabase Auth 利用（ログイン・ログアウト・セッション取得） | 未着手 | |
| 1.3 | 認証状態に応じたルーティング・ガード（未認証時はログイン画面へ） | 未着手 | |
| 1.4 | 必要に応じた RLS（Row Level Security）の設定 | 未着手 | |

**備考**:

---

## 2. Weekly 機能の追加（優先度：高）

**全体状況**: 未着手

| # | タスク | 状況 | メモ |
|---|--------|------|------|
| 2.1 | 既存のリフト稼働データを日次で集約するモデル・クエリの検討 | 未着手 | |
| 2.2 | 「1 週間」「リフト単位」で取得する API または Server Component 用のデータ取得 | 未着手 | |
| 2.3 | Weekly 用の画面・コンポーネントの追加（日付範囲選択、リフト選択、一覧表示） | 未着手 | |
| 2.4 | 認証ユーザーのみ閲覧可能とするかどうかの方針決定 | 未着手 | |

**備考**:

---

## 3. マイページの追加（優先度：中）

**全体状況**: 未着手

| # | タスク | 状況 | メモ |
|---|--------|------|------|
| 3.1 | お気に入りゲレンデ・リフトを保存するテーブル設計（Supabase）、ユーザー ID 紐づけ | 未着手 | |
| 3.2 | お気に入りの登録・解除 API または Server Actions | 未着手 | |
| 3.3 | トップや一覧で「お気に入り」でフィルタ／ハイライトするかどうかの仕様検討 | 未着手 | |
| 3.4 | マイページ画面のルート・レイアウト作成（プロフィール、お気に入り、設定、ログアウト等） | 未着手 | |
| 3.5 | 認証必須とする（未ログイン時はログインへリダイレクト） | 未着手 | |

**備考**:

---

## 4. 課金システムの導入（優先度：中）

**全体状況**: 未着手

| # | タスク | 状況 | メモ |
|---|--------|------|------|
| 4.1 | Stripe アカウント・プロダクト・価格（月額・年額）の作成 | 未着手 | |
| 4.2 | 月額の「12 月〜5 月のみ課金」の実現方式の検討・選定 | 未着手 | |
| 4.3 | Checkout Session または Customer Portal を用いた申込・解約フロー | 未着手 | |
| 4.4 | Webhook で支払い成功・解約等を検知し、Supabase 等に有料ユーザー・プラン種別を反映 | 未着手 | |
| 4.5 | フロント：プラン一覧、申込ボタン、マイページでの契約状況表示 | 未着手 | |

**備考**:

---

## 5. 天気情報の追加（優先度：中〜低）

**全体状況**: 未着手

| # | タスク | 状況 | メモ |
|---|--------|------|------|
| 5.1 | 気象 API の選定（条件・候補の調査・比較） | 未着手 | |
| 5.2 | ゲレンデと地域・座標のマッピング検討 | 未着手 | |
| 5.3 | 選定 API を用いたバックエンドの実装 | 未着手 | |
| 5.4 | ゲレンデ詳細または一覧への天気ブロックの追加、降雪量・降雨量の表示 | 未着手 | |
| 5.5 | キャッシュ・更新頻度の検討 | 未着手 | |

**備考**:

---

## 更新履歴（任意）

| 日付 | 変更内容 |
|------|----------|
| 2025-02-10 | Supabase SSR移行完了、Middleware実装は保留（認証機能実装時まで） |
| （例）2025-02-07 | 進捗管理ドキュメント作成 |

---

### 進捗の付け方

1. タスクの **状況** を `未着手` → `作業中` → `完了` で更新する。
2. **メモ** に担当・期限・ブロッカーなどを書いてよい。
3. 機能ごとのタスクがすべて `完了` になったら、**全体状況** と **全体サマリ** の進捗数を更新する。
4. **最終更新** に日付を入れる。
